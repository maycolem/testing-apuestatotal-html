"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1357],{51357:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{KountSDKVersion:function(){return KountSDKVersion},default:function(){return kountSDK}});let KountSDKVersion="1.1.6";function kountSDK(config,sessionID){let sdk={KountSDKVersion,kountClientID:null,isSinglePageApp:!1,collectorURL:null,sessionID:null,FPCV_COOKIE_NAME:"clientside-cookie",FPCV_LOCAL_STORAGE_KEY:"clientside-local",FPCV_SESSION_STORAGE_KEY:"kountCookie",SESSION_STORAGE_KEY_SESSION_ID:"KountSessionID",collectBehaviorData:!1,collectionCompleteTimeout:5e3,callbacks:{},isCompleted:!1,error:[],isDebugEnabled:!1,LOG_PREFIX:"k:",serverConfig:null,orchestrateTimeoutId:null,updateSDKServerConfigTimeoutInMS:3e3,orchestrateSemaphoreLocked:!1,start(t,e){if(void 0===t)return window.console&&window.console.log&&console.log(`${this.LOG_PREFIX}SDK Disabled: config required.`),!1;this.isDebugEnabled=void 0!==t.isDebugEnabled&&"boolean"==typeof t.isDebugEnabled&&t.isDebugEnabled,this.log(`SDK isDebugEnabled=${this.isDebugEnabled}`),this.log("SDK starting...");let o=t.clientID;if(void 0===o||0===o.length)return this.log("SDK Disabled: clientID required."),!1;this.kountClientID=o,void 0!==t.callbacks&&(this.callbacks=t.callbacks);let s=this._getHostname(t);if(null==s)return this.log("SDK Disabled: unresolved hostname."),!1;this.collectorURL=`https://${s}`,this.log(`collectorURL=${this.collectorURL}`);let i=t.isSinglePageApp;return void 0===i||!0!==i&&!1!==i?(this.log(`SDK Disabled: invalid isSinglePageApp:${i}`),!1):(this.isSinglePageApp=i,this.log(`isSinglePageApp=${this.isSinglePageApp}`),void 0===e||0===e.length)?(this.log("SDK Disabled: sessionID required."),!1):(this.sessionID=e,this._communicateLatestSessionData(),this._orchestrate(),this.log(`SDK Version=${this.KountSDKVersion}`),this.log("SDK started."),!0)},_orchestrate:async function(){let t="_orchestrate",e=!1;try{if(this.orchestrateSemaphoreLocked){this.log(`${t} gated by semaphore. Skipping...`);return}this.orchestrateSemaphoreLocked=!0,e=!0,this.log(`${t} start...`),this.serverConfig=await this._getServerConfig(),this.serverConfig.da.enabled?config.triggers?(this.log(`${t} _runDA start...`),this._runDA(config.triggers,this.serverConfig.da.subdomain,this.serverConfig.da.orgId),this.log(`${t} _runDA end...`)):this.log(`${t} _runDA disabled:triggers missing.`):this.log(`${t} _runDA disabled.`),this.serverConfig.collector.run?(this.log(`${t} runCollector start...`),this.runCollector(),this.log(`${t} runCollector end...`)):(this.log(`${t} runCollector skipped...`),this.callback("collect-begin",{SessionID:this.sessionID,KountClientID:this.kountClientID}),this.callback("collect-end",{SessionID:this.sessionID,KountClientID:this.kountClientID}))}catch(s){let o=`${t} unexpected error: ${s}`;this.log(o),this.addError(o)}finally{if(!e)return;clearTimeout(this.orchestrateTimeoutId),this.log(`${t} config:${JSON.stringify(this.serverConfig)}`);let i=this.serverConfig.ttlms;this.orchestrateTimeoutId=setTimeout(this._orchestrate.bind(this),i),this.log(`${t} scheduled for ${i} ms`),this.log(`${t} end...`),this.orchestrateSemaphoreLocked=!1}},_wrapPromiseInTimeout:(t,e)=>new Promise((o,s)=>{let i=setTimeout(()=>{s(Error(`Timeout after ${t}ms.`))},t);e.then(t=>{clearTimeout(i),o(t)}).catch(t=>{clearTimeout(i),s(t)})}),async _getServerConfig(){let t="_getServerConfig";var e=null;try{this.log(`${t} start...`);let o=`${this.collectorURL}/cs/config?m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,s=await this._wrapPromiseInTimeout(this.updateSDKServerConfigTimeoutInMS,fetch(o));if(!s.ok)throw`response not ok: ${s.status}`;let i=await s.json();e=this._translateJSONToServerConfig(i)}catch(r){let n=`${t} error caught. e:${r}`;this.log(n),this.addError(n)}finally{return null==e&&(e={ttlms:9e5,collector:{run:!0,featureFlags:{app:!0,battery:!0,browser:!0,da:!1,exp:!0,page:!0,ui:!0}},da:{enabled:!1}}),this.log(`${t} config: ${JSON.stringify(e)}`),this.log(`${t} end...`),e}},_translateJSONToServerConfig(t){let e=this._translateTTLMSConfig(t),o=this._translateCollectorConfig(t),s=this._translateDAConfig(t);return{ttlms:e,collector:o,da:s}},_translateTTLMSConfig:t=>"number"!=typeof t.ttlms?9e5:t.ttlms,_translateCollectorConfig(t){let e="_translateCollectorConfig",o=null;try{if(this.log(`${e} start...`),void 0===t.collection||void 0===t.collection.feature_flags)throw`invalid response JSON:${JSON.stringify(t)}`;if("boolean"!=typeof t.collection.collect)throw`collect is not boolean: ${typeof collection.collect}`;let s=t.collection.collect;if(s){let i=t.collection.feature_flags;if("boolean"!=typeof i.app)throw`app feature flag is not boolean: ${typeof i.app}`;if("boolean"!=typeof i.battery)throw`battery feature flag is not boolean: ${typeof i.battery}`;if("boolean"!=typeof i.browser)throw`browser feature flag is not boolean: ${typeof i.browser}`;if("boolean"!=typeof i.da)throw`da feature flag is not boolean: ${typeof i.da}`;if("boolean"!=typeof i.exp)throw`exp feature flag is not boolean: ${typeof i.exp}`;if("boolean"!=typeof i.page)throw`page feature flag is not boolean: ${typeof i.page}`;if("boolean"!=typeof i.ui)throw`ui feature flag is not boolean: ${typeof i.ui}`;o={run:s,featureFlags:t.collection.feature_flags}}else o={run:s}}catch(r){let n=`${e} error caught. e:${r}`;this.log(n),this.addError(n)}finally{return null==o&&(o={run:!0,featureFlags:{app:!0,battery:!0,browser:!0,da:!1,exp:!0,page:!0,ui:!0}}),this.log(`${e} end...`),o}},_translateDAConfig(t){let e="_translateDAConfig",o=null;try{if(this.log(`${e} start...`),t.da){if(!t.da.orgId)throw"da.orgId missing.";if(!t.da.subdomain)throw"da.subdomain missing.";o={enabled:!0,orgId:t.da.orgId,subdomain:t.da.subdomain}}else o={enabled:!1},this.log(`${e} da disabled.`)}catch(i){let s=`${e} ${i}`;this.log(s)}finally{return null==o&&(o={enabled:!1}),this.log(`${e} end...`),o}},_getHostname(t){let e=t.hostname;if(void 0!==e){if(this._isHostnameValid(e)){let o=t.environment;return o&&this.log(`warning:both 'environment':${o} and deprecated 'hostname':${e} configs were specified. using hostname.`),e}return this.log(`invalid configuredHostname:${e}`),null}let s=t.environment;switch(s&&(s=s.toUpperCase()),s){case"TEST":return"tst.kaptcha.com";case"PROD":return"ssl.kaptcha.com";default:return this.log(`invalid configuredEnvironment:${s}`),null}},_isHostnameValid(t){if("string"!=typeof t)return this.log(`Invalid hostname: not a string: ${typeof t}`),!1;if(0===t.length)return this.log("Invalid hostname: length 0."),!1;let e=/^[a-zA-Z0-9.]*$/g;return!!e.test(t)||(this.log(`Invalid hostname:${t}`),!1)},_communicateLatestSessionData(){try{this.log("communicateLatestSessionData running...");let t=sessionStorage.getItem(this.SESSION_STORAGE_KEY_SESSION_ID);null===t?this.postNewSession(this.sessionID):t!==this.sessionID&&this.postChangeSession(this.sessionID,t),sessionStorage.setItem(this.SESSION_STORAGE_KEY_SESSION_ID,this.sessionID)}catch(e){this.addError(`communicateLatestSessionData error:${e}`)}finally{this.log("communicateLatestSessionData ending...")}},async postNewSession(t){try{this.log("postNewSession running...");let e=`${this.collectorURL}/session/${t}`;this._postToURL(e,"postNewSession")}catch(o){this.addError(`postNewSession error:${o}`)}finally{this.log("postNewSession ending...")}},async postChangeSession(t,e){try{this.log(`postChangeSession running: newSession: ${t} prevSession: ${e}`);let o=`${this.collectorURL}/session/${this.sessionID}?previousSessionID=${e}`;this._postToURL(o,"postChangeSession")}catch(s){this.addError(`postChangeSession error:${s}`)}finally{this.log("postChangeSession ending...")}},async _postToURL(t,e){try{this.log(`_postToURL:${e} running...`);let o=new XMLHttpRequest;o.onreadystatechange=()=>{o.readyState===XMLHttpRequest.DONE&&(200===o.status||201===o.status?this.log(`${e} success.`):(this.addError(`${e} unknown response: ${o.status}`),this.log(`${this.error}:unknown response - ${o.status}`)))},o.open("POST",t,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.setRequestHeader("client-id",this.kountClientID),o.send()}catch(s){throw s}finally{this.log(`_postToURL:${e} ending...`)}},getFPCVFromLocalStorage(){try{this.log("getFPCVFromLocalStorage running...");let t=localStorage.getItem(this.FPCV_LOCAL_STORAGE_KEY);if(null==t)return"";return t}catch(e){return this.addError(`getFPCVFromLocalStorage: error${e}`),""}},getFPCVFromCookie(){try{this.log("getFPCVFromCookie running...");let t=decodeURIComponent(document.cookie),e=t.split(";"),o="";for(let s=0;s<e.length;s++){let i=e[s].trim(),n=i.split("=");if(2===n.length&&n[0]===this.FPCV_COOKIE_NAME){[,o]=n,this.log(`getFPCVFromCookie: found new first party cookie: ${o}`);break}}if(""===o){let r=/(cdn[.][a-z]+[.][0-9]+[.]ka.ck)/g;for(let l=0;l<e.length;l++){let a=e[l].trim();if(!0===r.test(a)){let h=a.split("=");if(2===h.length){[,o]=h,this.log(`getFPCVFromCookie: found old first party cookie: ${o}`),this.storeFPCVInCookie(o);break}}}}return o}catch(c){return this.addError(`getFPCVFromCookie error:${c}`),""}},storeFPCVInLocalStore(t){try{this.log("storeFPCVInLocalStore running..."),localStorage.setItem(this.FPCV_LOCAL_STORAGE_KEY,t)}catch(e){this.addError(`storeFPCVInLocalStore error:${e}`)}finally{this.log("storeFPCVInLocalStore ending...")}},storeFPCVInCookie(t){try{this.log("storeFPCVInCookie running...");let e=365,o=new Date;o.setTime(o.getTime()+864e5*e);let s=`expires=${o.toUTCString()}`,i="; SameSite=None; Secure";"https:"!==window.location.protocol&&(i="; SameSite=Lax"),document.cookie=`${this.FPCV_COOKIE_NAME}=${t};${s};path=/${i}`}catch(n){this.addError(`storeFPCVInCookie error:${n}`)}finally{this.log("storeFPCVInCookie ending...")}},storeFPCVInSession(t){try{this.log("storeFPCVInSession running..."),sessionStorage.setItem(sdk.FPCV_SESSION_STORAGE_KEY,t)}catch(e){this.addError(`storeFPCVInSession error:${e}`)}},coordinateFirstPartyCookieValues(){this.log("coordinateFirstPartyCookieValues running...");let t="",e=this.getFPCVFromCookie(),o=this.getFPCVFromLocalStorage();this.storeFPCVInSession(""),""===e&&""===o?t="":""!==e&&""===o?(this.storeFPCVInLocalStore(e),t=e):""!==o&&""===e?(this.storeFPCVInCookie(o),t=o):o===e&&""!==o&&""!==e?t=o:o!==e&&""!==o&&""!==e&&(this.storeFPCVInCookie(o),t=o),""===t?this.establishNewFPCV():this.communicateExistingFPCV(t)},async establishNewFPCV(){try{this.log("establishNewFPCV running...");let t=`${this.collectorURL}/cs/generatecookie?m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,e=await fetch(t),o=await e.json();if(o.value.length>0){let s=o.value;this.storeFPCVInCookie(s),this.storeFPCVInLocalStore(s),this.storeFPCVInSession(s)}}catch(i){this.addError(`establishNewFPCV error:${i}`)}finally{this.log("establishNewFPCV ending...")}},async communicateExistingFPCV(t){try{this.log("communicateExistingFPCV running...");let e=`${this.collectorURL}/cs/storecookie`,o=`m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}&k=${t}`,s=new XMLHttpRequest;s.onreadystatechange=()=>{4===s.readyState&&500===s.status&&(this.log("communicateExistingFPCV: invalid cookie"),sdk.establishNewFPCV()),4===s.readyState&&200===s.status&&(this.log("communicateExistingFPCV: valid cookie"),sdk.storeFPCVInSession(t))},s.open("POST",e,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.send(o)}catch(i){this.addError(`communicateExistingFPCV error:${i}`)}},_createIframe(){let functionName="_createIframe";try{this.log(`${functionName} running...`);let iframeId="ibody",priorIframe=document.getElementById(iframeId);null!==priorIframe&&priorIframe.remove();let queryString=`m=${this.kountClientID}&s=${this.sessionID}&sv=${this.KountSDKVersion}`,iframe=document.createElement("iframe");iframe.id=iframeId,iframe.style.border="0px",iframe.style.height="1px",iframe.style.width="1px",iframe.style.position="absolute",iframe.src=`${this.collectorURL}/logo.htm?${queryString}`,document.getElementsByTagName("body")[0].appendChild(iframe),void 0!==this.callbacks&&this.callback("collect-begin",{SessionID:this.sessionID,KountClientID:this.kountClientID}),"undefined"!==window.postMessage&&"undefined"!==window.onmessage?(window.onmessage=event=>{let data=null;if(event.origin===this.collectorURL){data=JSON?JSON.parse(event.data):eval(event.data),this.isSinglePageApp||"collect-end"!==data.event||this.detach(window,"unload",this.unloadHandler);let params={};Object.keys(data.params).forEach(t=>{if(Object.prototype.hasOwnProperty.call(data.params,t))switch(t){case"s":params.SessionID=data.params[t];break;case"m":params.KountClientID=data.params[t];break;default:params[t]=data.params[t]}}),this.isCompleted=!0,this.callback(data.event,params)}},this.isSinglePageApp||this.attach(window,"unload",this.unloadHandler)):window.setTimeout(()=>{this.isCompleted=!0,this.callback("collect-end",{SessionID:this.sessionID,KountClientID:this.kountClientID})},3e3)}catch(e){this.addError(`${functionName} error:${e}`)}finally{this.log(`${functionName} ending...`)}},runCollector(){let t="runCollector";try{this.log(`${t} running...`),this.isCompleted=!1,setTimeout(()=>{this.isCompleted=!0},this.collectionCompleteTimeout),this.coordinateFirstPartyCookieValues();let e=(t,e)=>new Promise((o,s)=>{let i=()=>{""!==sessionStorage.getItem(this.FPCV_SESSION_STORAGE_KEY)?(this._createIframe(),o()):(t-=e)<0?s():setTimeout(i,e)};setTimeout(i,e)});(async()=>{e(2e3,10).then(()=>this.log(`${t}: Collection Initiated`)).catch(()=>this.log(`${t}: Invalid/Missing First Party cookie`))})()}catch(o){this.addError(`${t} error:${o}`)}finally{this.log(`${t} ending...`)}},_runDA(t,e,o){let s="_runDA";try{this.log(`${s} running...`),this.log(`${s} setting da session store`);var i=document.createElement("script");let n="https://"+e+".callsign.com";i.setAttribute("src",n+"/in/web-sdk/v1/static/web-sdk.js"),document.head.appendChild(i);let r={essx:n,esto:o,ggow:sessionID,mosc:sessionID,mwel:"Kount",mwelseq:1,mwelsub:"Kount",loco:!1,ewps:!1,reed:!0,sanf:JSON.stringify(t),timestamp:Date.now()};this.log(`${s} daConfig:${JSON.stringify(r)}`),sessionStorage.setItem("cx",JSON.stringify(r)),this.log(`${s} da session store set`)}catch(l){this.log(`${s} unexpected da error: ${l}`)}finally{this.log(`${s} ending...`)}},AttachToForm(t,e=new Map){this.log("AttachToForm running...");let o="kountDecisionPointUUID";this.collectBehaviorData,this.log("AttachToForm: Attaching to form...");let s=document.getElementById(t);if(null!=e&&e.has("CustomFieldName")&&e.get("CustomFieldName").length>0&&(this.log(`AttachToForm: Overriding decisionPointField name to: ${e.get("CustomFieldName")}`),o=e.get("CustomFieldName")),null!=s){if(void 0===s[o]){let i=document.createElement("input");i.setAttribute("type","hidden"),i.setAttribute("name",o),i.setAttribute("value",this.sessionID),s.appendChild(i),this.log(`AttachToForm: Field ${o} NOT found. \
                    Created and attached to form with value: ${this.sessionID}`)}else this.log(`AttachToForm: Field ${o} found, setting value to: ${this.sessionID}`),s[o].setAttribute("value",this.sessionID);this.log(`AttachToForm: Attached to form successfully using ${this.sessionID} \
                value in ${o} hidden field.`)}else this.addError(`AttachToForm: FormID: ${t} is not valid. Skipping attachment to form and collection.`)},NewSession(t){void 0===t?this.addError("NewSession: Invalid sessionID.  You must set the 'sessionID' for collection. Disabling Kount SDK"):(this.log(`NewSession: SessionID set to: ${t}`),sessionStorage.clear(),this.sessionID=t,this._communicateLatestSessionData(),this._orchestrate())},IsCompleted(){return this.isCompleted},log(t){this.isDebugEnabled&&window.console&&window.console.debug&&console.debug(`${this.LOG_PREFIX}${t}`)},addError(t){this.error.push(t),this.log(t)},callback(t,e){if(void 0!==this.callbacks[t]){let o=this.callbacks[t];this.callbacks[t]=void 0,o(e)}},unloadHandler(t){let e="fin",o={n:"collect-end",com:"false",et:0,s:this.sessionID,m:this.kountClientID};try{let s=this.getXMLHttpRequest(e,"POST");s.send(o)}catch(i){}},getXMLHttpRequest(t,e){let o=null,s=encodeURIComponent||escape,i=`${this.collectorURL}/${t}`;if(window.XMLHttpRequest){try{o=new window.XMLHttpRequest}catch(n){}"withCredentials"in o?o.open(e,i,!1):void 0!==window.XDomainRequest?(o=new window.XDomainRequest).open(e,i):o=null}else o=null;return{send(t){if(!o)return;o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");let e="";Object.keys(t).forEach(o=>{Object.prototype.hasOwnProperty.call(t,o)&&(e+=`&${s(o)}=${s(t[o])}`)}),e=e.substring(1),o.send(e)}}},attach:void 0!==document.addEventListener?function(t,e,o){t.addEventListener(e,o,!1)}:void 0!==document.attachEvent?function(t,e,o){t.attachEvent(`on${e}`,o)}:function(t,e,o){},detach:void 0!==document.removeEventListener?function(t,e,o){t.removeEventListener(e,o,!1)}:void 0!==document.detachEvent?function(t,e,o){t.detach(`on${e}`,o)}:function(t,e,o){}};try{if(sdk.start(config,sessionID))return sdk}catch(e){}return null}}}]);